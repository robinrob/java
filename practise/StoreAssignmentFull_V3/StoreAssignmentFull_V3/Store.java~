import java.util.*;

/**
 * This class implements a simple simulation of an online store
 * 
 * @author Pablo Romero
 * @version 2004.08.28
 */
public class Store
{
    private Catalogue catalogue;
    private ShoppingBasket basket;
    private PhraseGenerator phraseGenerator;
    private ArrayList<Address> addressesList;
    private Address[] addressesArray;
    private Address deliveryAddress;
    private Formatter formatter;

    /**
     * Create a new Store
   **/
    public Store() 
      {
        catalogue = new Catalogue();
        basket = new ShoppingBasket();
        addressesList = new ArrayList<Address>();
        formatter = new Formatter();
    }

    /**
     * Interacts with the user in a simple way. When the user inputs a
     * valid product, this method asks for the number of products of
     * this type to add to the shopping basket. If the product entered
     * is not valid, the method alerts the user of this and asks for 
   * another product. The interaction finishes when the user enters
     * the special term `finish'. The method prints out the total amount
   * to pay for the items in the shopping basket before finishing
   **/
    public void interact() 
    {
        System.out.println("\n\n-----------------------------------");
        System.out.println("Welcome to Robin's shop!");
        System.out.println("-----------------------------------");
        System.out.println("Enter a menu option (module) to start");
        printHelp();
        System.out.println("    Type 'help' for help\n");
        printMainMenu();
        System.out.print("\nMenu: ");
        String input = EasyIn.getString();

        while (!input.equals("exit")) 
        {
            if (input.equals("menu"))
                printMainMenu();
            else if (input.equals("help"))
                printHelp();
            else if (input.equals("1"))
                showProducts();
            else if (input.equals("2"))
                searchForProducts(input);
            else if (input.equals("3"))
                addToBasket();
            else if (input.equals("4"))
                removeFromBasket();
            else if (input.equals("5"))
                modifyItemQuantity();
            else if (input.equals("6"))
                showBasket();
            else if (input.equals("7"))
                checkout();
            else
                System.out.println("\nCommand not recognised.");

            
            System.out.print("\nMenu: ");
            input = EasyIn.getString();
        }
        System.out.println("\nSystem exited");
    }
    
    
    public void printHelp()
    {
        System.out.println("");
        System.out.println("    Important commands: ");
        System.out.println("    Type 'menu' for main menu");
        System.out.println("    Type 'exit' at main menu to exit the system");
        System.out.println("    Type 'exit' while in a module to exit to main menu");
    }
        
    public void printMainMenu()
    {
        System.out.print("\n");
        System.out.println("(1) Show list of products");
        System.out.println("(2) Search for product");
        System.out.println("(3) Add item to basket");
        System.out.println("(4) Remove item from basket");
        System.out.println("(5) Modify quantity of items in basket");
        System.out.println("(6) Show contents of basket");
        System.out.println("(7) Checkout");
        System.out.println("(8) My account");

    }
    
    public void showProducts()
    {
        ArrayList<String> labels = catalogue.getLabels();
        System.out.print("\n");
        for (String label : labels){
            System.out.println(label);
        }
    }
    
    public void searchForProducts(String input)
    {
        while (!input.equals("exit")){
             System.out.print("\nMenu: Search: ");
             input = EasyIn.getString(); 
       
             ArrayList<String> possibleTerms = new ArrayList<String>();
             possibleTerms = catalogue.findPossibleProducts(input);
      
             if (possibleTerms.size() > 1){
                 System.out.println("\nDid you mean: ");
                 for (String term : possibleTerms){
                     System.out.println(term);
                    }
                }
                
                else if (possibleTerms.size() == 1){
                    String term = possibleTerms.get(0);
                    if (!term.equals(input)){
                        System.out.println("\nDid you mean: \n" + term);
                    }
                    else {
                        catalogue.printProductDetails(term);
                    }
                }
                else {
                    System.out.println("Search term found no matches.");
                }
            }
    }
    
    public void addToBasket()
    {
        System.out.print("\nMenu: Add to basket: Product name: ");
        String inputName = EasyIn.getString();
        System.out.print("Menu: Add to basket: Product quantity ");
        int inputQuantity = EasyIn.getInt();
        if (catalogue.productExists(inputName)){
            basket.addItem(inputName,catalogue.getProductPrice(inputName),inputQuantity);
            System.out.println("Item added successfully");
            }
        else {
            System.out.println("Item not added");
        }
    }
    
    public void removeFromBasket()
    {
        System.out.print("\nMenu: Remove from basket: Product name: ");
        String input = EasyIn.getString();
        if (basket.deleteItem(input)){
            System.out.println("Item removed successfully");
        }
        else {
            System.out.println("Item not removed");
        }
    }
    
    public void modifyItemQuantity()
    {
        System.out.print("\nMenu: Modify quantity: Product name: ");
        String inputName = EasyIn.getString();
        if(!inputName.equals("exit")){
            System.out.print("Menu: Modify quantity: New quantity: ");
            int inputQuantity = EasyIn.getInt();
            if (basket.itemExists(inputName)){
                basket.getItem(inputName).changeQuantity(inputQuantity);
                System.out.println("Item quantity successfully modified");
            }
            else {
                System.out.println("Item quantity not modified");
            }
        }
    }
            
    
    public void showBasket()
    {
        ArrayList<ShoppingItem> items = basket.getItems();
        System.out.println("\n**Shopping basket**");
        System.out.println(formatter.rightJustify("Product name:", 20) + formatter.rightJustify("Price (p):", 10) 
                                + formatter.rightJustify("Quantity:", 10) + formatter.rightJustify("Total (p):", 10));
        int total = 0;
        for (ShoppingItem item : items){
            System.out.println(formatter.rightJustify(item.getLabel(), 20) + formatter.rightJustify(item.getPrice(), 10) 
            + formatter.intJustify(item.getQuantity(), 10) + formatter.intJustify(item.getTotal(), 10));
            total += item.getTotal();
        }
        System.out.println("\n    Total to pay (p): " + total);
    }
    
    private void deliveryDetails()
    {
        System.out.println("**Delivery details**\n");
        System.out.println("(1) Add an address");
        System.out.println("(2) Edit an address");
        System.out.println("(3) Remove an address");
        System.out.println("(4) Specify delivery address");
        System.out.println("(5) Show delivery address");
        
        System.out.print("\nMenu: Delivery details: ");
        String input = EasyIn.getString();
        
        if (input.equals("1"))
            addAddress();
        else if (input.equals("2"))
            editAddress();
        else if (input.equals("3"))
            removeAddress();
        else if (input.equals("4"))
            specifyDeliveryAddress();
        else if (input.equals("5"))
            showDeliveryAddress();
    }
    
    private void addAddress()
    {
        System.out.println("\nMenu: Delivery details: Add address: House number :");
        int inputNumber = EasyIn.getInt();
        System.out.println("\nMenu: Delivery details: Add address: Street:");
        String inputStreet = EasyIn.getString();
        System.out.println("\nMenu: Delivery details: Add address: Address1:");
        String inputAddress1 = EasyIn.getString();
        System.out.println("\nMenu: Delivery details: Add address: Address2:");
        String inputAddress2 = EasyIn.getString();
        System.out.println("\nMenu: Delivery details: Add address: Address3:");
        String inputAddress3 = EasyIn.getString();
        System.out.println("\nMenu: Delivery details: Add address: Postcode:");
        String inputPostcode = EasyIn.getString();
        
        addressesList.add(new Address(inputNumber, inputStreet, inputAddress1, inputAddress2, inputAddress3, inputPostcode));
    }
    
    private void editAddress()
    {
        System.out.println("\n**Your addresses**\n");
        
        showAddresses();

        System.out.println("\nChoose an address to edit");
        System.out.println("Menu: Delivery details: Edit address: ");
        String input = EasyIn.getString();
        
        int index = 0;
        if (!input.equals("exit")){
            int inputInt = Integer.parseInt(input);
            System.out.println("\nAddress to edit: ");
            addressesArray[inputInt-1].printAddress();
                  
            System.out.println("\nMenu: Delivery details: Edit address: House number :");
            int inputNumber = EasyIn.getInt();
            System.out.println("\nMenu: Delivery details: Edit address : Street:");
            String inputStreet = EasyIn.getString();
            System.out.println("\nMenu: Delivery details: Edit address: Address1:");
            String inputAddress1 = EasyIn.getString();
            System.out.println("\nMenu: Delivery details: Edit address: Address2:");
            String inputAddress2 = EasyIn.getString();
            System.out.println("\nMenu: Delivery details: Edit address: Address3:");
            String inputAddress3 = EasyIn.getString();
            System.out.println("\nMenu: Delivery details: Edit address: Postcode:");
            String inputPostcode = EasyIn.getString();
            
            addressesArray[inputInt-1] = new Address(inputNumber, inputStreet, inputAddress1, inputAddress2, inputAddress3, inputPostcode);
            System.out.println("\n**Your new address**");
            addressesArray[inputInt-1].printAddress();
        }
    }
            
    
    private void showAddresses()
    {
        addressesArray = (Address[]) addressesList.toArray();
        
        int index = 1;
        for (Address address : addressesArray){
            System.out.println("  Address number ("+index+")");
            address.printAddress();
            index++;
        }
    }

    
    private void removeAddress()
    {
        showAddresses();
        
        System.out.println("\nChoose an address to remove");
        String input = EasyIn.getString();
        
        if(!input.equals("exit")){
            int inputInt = Integer.parseInt(input);
            addressesArray[inputInt-1] = null;
        }
    }
    
    private void specifyDeliveryAddress()
    {
        System.out.println("\n**Your addresses**\n");
        
        int index = 1;
        for (Address address : addressesArray){
            System.out.println("  Address number ("+index+")");
            address.printAddress();
            index++;
        }
        System.out.println("\nChoose a a delivery address: ");
        String input = EasyIn.getString();
        
        if(!input.equals("exit")){
            int inputInt = Integer.parseInt(input);
            deliveryAddress = addressesArray[inputInt];
        }
    }
    
    private void showDeliveryAddress()
    {
        System.out.println("\n**Your delivery address**");
        deliveryAddress.printAddress();
    }
        
    
    //private void arrayToList(Object[] objects)
    //{
    //    ArrayList<Object> list = null;
    //    
    //    for (Object object : objects){
    //        list.add(object);
    //    }
    //}
        
    private void checkout()
    {
        System.out.println("**Checkout**\n");
        System.out.println("(1) Your items");
        System.out.println("(2) Delivery details)");
        
        System.out.print("Menu: Checkout: ");
        String input = EasyIn.getString();
        
        if (input.equals("1"))
            showBasket();
        else if (input.equals("2"))
            deliveryDetails();
            
        }
        

 
    
   


}
